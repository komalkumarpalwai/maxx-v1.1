"use strict";(self.webpackChunkmax_solutions_client=self.webpackChunkmax_solutions_client||[]).push([[387],{387:(e,t,s)=>{s.r(t),s.d(t,{default:()=>c});var a=s(379),n=s(43),l=s(305),i=s(579);function o(e){let{questions:t,testId:s,testTitle:l,onClose:o,fetchQuestions:r}=e;const[c,d]=(0,n.useState)(null),[u,x]=(0,n.useState)({}),[m,p]=(0,n.useState)(!1),[h,b]=(0,n.useState)(""),g=()=>{d(null),x({}),b("")},j=(e,t)=>x(s=>(0,a.A)((0,a.A)({},s),{},{[e]:t}));return(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white p-6 rounded-lg w-full max-w-2xl max-h-[90vh] flex flex-col overflow-y-auto border border-gray-200",children:[(0,i.jsxs)("h3",{className:"font-semibold text-lg mb-4",children:["Questions for: ",(0,i.jsx)("span",{className:"text-blue-700",children:l})]}),0===t.length?(0,i.jsx)("div",{className:"text-gray-500",children:"No questions found for this test. Please ensure that the duration is set correctly."}):(0,i.jsx)("ol",{className:"list-decimal ml-5 space-y-3",children:t.map((e,t)=>(0,i.jsx)("li",{className:"mb-2",children:c===t?(0,i.jsxs)("div",{className:"border rounded p-2 bg-gray-50",children:[(0,i.jsx)("input",{className:"input w-full mb-1",value:u.question,onChange:e=>j("question",e.target.value)}),(0,i.jsxs)("div",{className:"flex gap-2 mb-1",children:[(0,i.jsx)("input",{className:"input flex-1",placeholder:"Option 1",value:u.option1,onChange:e=>j("option1",e.target.value)}),(0,i.jsx)("input",{className:"input flex-1",placeholder:"Option 2",value:u.option2,onChange:e=>j("option2",e.target.value)}),(0,i.jsx)("input",{className:"input flex-1",placeholder:"Option 3",value:u.option3,onChange:e=>j("option3",e.target.value)}),(0,i.jsx)("input",{className:"input flex-1",placeholder:"Option 4",value:u.option4,onChange:e=>j("option4",e.target.value)})]}),(0,i.jsxs)("div",{className:"flex gap-2 mb-1",children:[(0,i.jsxs)("select",{className:"input w-32",value:u.correctAnswer,onChange:e=>j("correctAnswer",e.target.value),children:[(0,i.jsx)("option",{value:"",children:"Correct Answer"}),(0,i.jsx)("option",{value:"1",children:"Option 1"}),(0,i.jsx)("option",{value:"2",children:"Option 2"}),(0,i.jsx)("option",{value:"3",children:"Option 3"}),(0,i.jsx)("option",{value:"4",children:"Option 4"})]}),(0,i.jsx)("input",{className:"input w-20",type:"number",min:"1",value:u.points,onChange:e=>j("points",e.target.value),placeholder:"Points"})]}),(0,i.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,i.jsx)("button",{className:"px-3 py-1 bg-blue-600 text-white rounded",onClick:()=>(async()=>{b("This feature will be released in version 2 of Maxx Solutions."),p(!1)})(),disabled:m,children:"Save"}),(0,i.jsx)("button",{className:"px-3 py-1 bg-gray-400 text-white rounded",onClick:g,disabled:m,children:"Cancel"})]}),h&&(0,i.jsx)("div",{className:"text-xs text-red-600 mt-1",children:h})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"font-medium",children:["Q",t+1,": ",e.question]}),(0,i.jsxs)("ul",{className:"ml-4 text-sm",children:[(0,i.jsxs)("li",{children:["A. ",e.options?e.options[0]:e.option1]}),(0,i.jsxs)("li",{children:["B. ",e.options?e.options[1]:e.option2]}),(0,i.jsxs)("li",{children:["C. ",e.options?e.options[2]:e.option3]}),(0,i.jsxs)("li",{children:["D. ",e.options?e.options[3]:e.option4]})]}),(0,i.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Correct: Option ",void 0!==e.correctAnswer&&null!==e.correctAnswer?Number(e.correctAnswer)+1:""," | Points: ",e.points]}),(0,i.jsx)("button",{className:"mt-1 px-2 py-1 bg-yellow-500 text-white rounded text-xs",onClick:()=>((e,t)=>{d(t),x({question:e.question,option1:e.options?e.options[0]:e.option1,option2:e.options?e.options[1]:e.option2,option3:e.options?e.options[2]:e.option3,option4:e.options?e.options[3]:e.option4,correctAnswer:void 0!==e.correctAnswer&&null!==e.correctAnswer?(Number(e.correctAnswer)+1).toString():"",points:e.points||1}),b("")})(e,t),children:"Edit"})]})},t))}),(0,i.jsx)("button",{className:"mt-6 px-4 py-2 bg-gray-400 text-white rounded self-end",onClick:o,children:"Close"})]})})}function r(e){let{closeQModal:t,handleAddQuestions:s,loading:l}=e;const[o,r]=(0,n.useState)(!1),[c,d]=(0,n.useState)(""),[u,x]=(0,n.useState)([]),[m,p]=(0,n.useState)(!1),[h,b]=(0,n.useState)([{question:"",option1:"",option2:"",option3:"",option4:"",correctAnswer:"",points:""}]),[g,j]=(0,n.useState)(0),[v,f]=(0,n.useState)("");const y=(e,t)=>{b(s=>s.map((s,n)=>n===g?(0,a.A)((0,a.A)({},s),{},{[e]:t}):s))};return(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white p-6 rounded-lg w-full max-w-md border border-gray-200 shadow-xl flex flex-col",style:{minWidth:350},children:[(0,i.jsx)("h2",{className:"font-semibold text-xl mb-3 text-gray-800",children:"Add Questions"}),(0,i.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,i.jsx)("button",{className:"px-3 py-1 bg-blue-500 text-white rounded",onClick:()=>r(!0),children:"Bulk Upload (CSV)"}),(0,i.jsx)("button",{className:"px-3 py-1 bg-gray-300 text-gray-600 rounded cursor-not-allowed",disabled:!0,children:"Generate with AI (Coming Soon)"})]}),o&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white p-4 rounded-lg w-full max-w-md border border-gray-200",children:[(0,i.jsx)("h4",{className:"font-semibold mb-2 text-gray-700",children:"CSV Format"}),(0,i.jsxs)("p",{className:"text-xs mb-2",children:["Columns: ",(0,i.jsx)("b",{children:"question, option1, option2, option3, option4, correctAnswer (1-4), points"})]}),(0,i.jsxs)("div",{className:"bg-gray-100 p-2 rounded text-xs mb-2",children:["question,option1,option2,option3,option4,correctAnswer,points",(0,i.jsx)("br",{}),"What is 2+2?,2,3,4,5,3,1",(0,i.jsx)("br",{}),"Capital of France?,London,Berlin,Paris,Rome,3,1"]}),(0,i.jsx)("input",{type:"file",accept:".csv",onChange:async e=>{d(""),x([]);const t=e.target.files[0];if(!t)return;if(!t.name.endsWith(".csv"))return void d("Please upload a .csv file.");const s=new FileReader;s.onload=e=>{try{const t=function(e){const t=e.trim().split(/\r?\n/);if(t.length<2)return[];const s=t[0].split(",").map(e=>e.trim());return t.slice(1).map(e=>{const t=e.split(","),a={};return s.forEach((e,s)=>{a[e]=t[s]?t[s].trim():""}),a})}(e.target.result);t.length?x(t):d("No valid questions found in CSV.")}catch(t){d("Failed to parse CSV.")}},s.readAsText(t)},className:"mb-2"}),u.length>0&&(0,i.jsxs)("div",{className:"mb-2 text-xs text-green-700",children:[u.length," questions ready to save."]}),c&&(0,i.jsx)("div",{className:"text-red-600 text-xs mb-2",children:c}),(0,i.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,i.jsx)("button",{className:"px-3 py-1 bg-blue-500 text-white rounded",onClick:async()=>{d(""),p(!0);const e=u.filter(e=>e.question&&e.option1&&e.option2&&e.option3&&e.option4&&e.correctAnswer&&e.points);if(!e.length)return d("No valid questions to save."),void p(!1);try{await s(e),r(!1),x([]),t()}catch(a){d("Failed to save questions.")}finally{p(!1)}},disabled:m||!u.length,children:m?"Saving...":"Save"}),(0,i.jsx)("button",{className:"px-3 py-1 bg-gray-500 text-white rounded",onClick:()=>r(!1),disabled:m,children:"Close"})]})]})}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("h3",{className:"font-semibold text-base mb-2 text-gray-700",children:"Create Questions Manually"}),(0,i.jsxs)("div",{className:"border border-gray-200 rounded p-3 bg-white flex flex-col gap-2",children:[(0,i.jsxs)("div",{className:"flex flex-wrap gap-2 items-center mb-2",children:[(0,i.jsx)("input",{className:"input flex-1 border-gray-300 text-sm",placeholder:"Question",value:h[g].question,onChange:e=>y("question",e.target.value)}),(0,i.jsx)("input",{className:"input w-20 border-gray-300 text-sm",placeholder:"Points",type:"number",value:h[g].points,onChange:e=>y("points",e.target.value)}),(0,i.jsx)("button",{className:"px-2 py-1 bg-red-100 text-red-600 rounded text-xs",onClick:()=>{1!==h.length&&(b(e=>e.filter((e,t)=>t!==g)),j(e=>e>0?e-1:0))},disabled:1===h.length,children:"Remove"})]}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,i.jsx)("input",{className:"input flex-1 border-gray-300 text-sm",placeholder:"Option 1",value:h[g].option1,onChange:e=>y("option1",e.target.value)}),(0,i.jsx)("input",{className:"input flex-1 border-gray-300 text-sm",placeholder:"Option 2",value:h[g].option2,onChange:e=>y("option2",e.target.value)}),(0,i.jsx)("input",{className:"input flex-1 border-gray-300 text-sm",placeholder:"Option 3",value:h[g].option3,onChange:e=>y("option3",e.target.value)}),(0,i.jsx)("input",{className:"input flex-1 border-gray-300 text-sm",placeholder:"Option 4",value:h[g].option4,onChange:e=>y("option4",e.target.value)}),(0,i.jsxs)("select",{className:"input w-28 border-gray-300 text-sm",value:h[g].correctAnswer,onChange:e=>y("correctAnswer",e.target.value),children:[(0,i.jsx)("option",{value:"",children:"Correct"}),(0,i.jsx)("option",{value:"1",children:"Option 1"}),(0,i.jsx)("option",{value:"2",children:"Option 2"}),(0,i.jsx)("option",{value:"3",children:"Option 3"}),(0,i.jsx)("option",{value:"4",children:"Option 4"})]})]}),(0,i.jsxs)("div",{className:"flex justify-between mt-2",children:[(0,i.jsx)("button",{className:"px-3 py-1 bg-gray-200 text-gray-800 rounded text-sm",onClick:()=>{g>0&&j(e=>e-1)},disabled:0===g,children:"Previous"}),(0,i.jsxs)("span",{className:"text-xs text-gray-500",children:["Question ",g+1," of ",h.length]}),(0,i.jsx)("button",{className:"px-3 py-1 bg-gray-200 text-gray-800 rounded text-sm",onClick:()=>{g===h.length-1&&b(e=>[...e,{question:"",option1:"",option2:"",option3:"",option4:"",correctAnswer:"",points:""}]),j(e=>e+1)},children:"Next"})]})]}),(0,i.jsxs)("div",{className:"mt-2",children:[(0,i.jsx)("h4",{className:"font-semibold text-xs mb-1 text-gray-600",children:"Summary"}),(0,i.jsx)("ul",{className:"text-xs text-gray-700 list-decimal ml-5",children:h.filter(e=>e.question.trim()).map((e,t)=>(0,i.jsx)("li",{className:t===g?"font-bold text-blue-600":"",children:e.question.slice(0,40)||"Untitled"},t))})]}),v&&(0,i.jsx)("div",{className:"text-red-600 text-xs mt-2",children:v})]}),(0,i.jsxs)("div",{className:"flex gap-2 justify-end mt-4",children:[(0,i.jsx)("button",{className:"px-4 py-2 bg-blue-500 text-white rounded",onClick:async()=>{f("");const e=h.filter(e=>e.question.trim());if(0!==e.length){for(let t=0;t<e.length;t++){const s=e[t];if(!s.option1||!s.option2||!s.option3||!s.option4)return void f("All options are required for question ".concat(t+1));if(!s.correctAnswer)return void f("Correct answer is required for question ".concat(t+1))}await s(e),t()}else f("Please add at least one question.")},disabled:l,children:"Save"}),(0,i.jsx)("button",{className:"px-4 py-2 bg-gray-300 text-gray-700 rounded",onClick:t,children:"Cancel"})]})]})})}const c=function(){const[e,t]=(0,n.useState)({open:!1,questions:[],testTitle:""}),[s,c]=(0,n.useState)([]),[d,u]=(0,n.useState)([]),x=d.length>0&&s.length===d.length,[m,p]=(0,n.useState)({open:!1,testId:null,idx:0,start:"",end:"",duration:""}),[h,b]=(0,n.useState)([]),g=async e=>{v(!0),y("");try{const s=await l.A.get("/tests/".concat(e._id,"/admin-questions"));t({open:!0,questions:s.data.questions||[],testTitle:e.title})}catch(s){y("Failed to fetch questions")}finally{v(!1)}},[j,v]=(0,n.useState)(!1),[f,y]=(0,n.useState)(""),[N,w]=(0,n.useState)(""),[A,C]=(0,n.useState)(!1),[k,S]=(0,n.useState)(null),[q,_]=(0,n.useState)([]),[D,T]=(0,n.useState)([]);(0,n.useEffect)(()=>{(async()=>{try{const e=await l.A.get("/meta/registration-options");_(e.data.branches||[]),T(e.data.years||[])}catch(e){_([]),T([])}})()},[]);const[L,O]=(0,n.useState)({open:!1,test:null,form:{}}),[Q,B]=(0,n.useState)({open:!1,testId:null,start:"",end:"",duration:""}),I=async()=>{v(!0),y("");try{const e=await l.A.get("/tests?all=1");u(e.data.tests||[])}catch(e){y("Failed to fetch tests")}finally{v(!1)}};(0,n.useEffect)(()=>{I()},[]);const R=()=>O({open:!1,test:null,form:{}}),F=(e,t)=>{O(s=>(0,a.A)((0,a.A)({},s),{},{form:(0,a.A)((0,a.A)({},s.form),{},{[e]:t})}))},[E,P]=(0,n.useState)(!0);return(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-semibold mb-2",children:"All Tests"}),j&&(0,i.jsxs)("div",{className:"flex items-center justify-center py-8",role:"status","aria-live":"polite",children:[(0,i.jsxs)("svg",{className:"animate-spin h-8 w-8 text-blue-600 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,i.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,i.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),(0,i.jsx)("span",{children:"Loading tests..."})]}),f&&(0,i.jsx)("div",{className:"text-red-600",children:f}),N&&(0,i.jsx)("div",{className:"text-green-600",children:N}),(0,i.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,i.jsx)("button",{className:"px-3 py-1 bg-red-600 text-white rounded disabled:opacity-50",onClick:async()=>{if(0!==s.length&&window.confirm("Are you sure you want to delete ".concat(s.length," selected test(s)? This action cannot be undone."))){v(!0),y(""),w("");try{for(const e of s)await l.A.delete("/tests/".concat(e));w("Selected tests deleted!"),c([]),I()}catch(e){y("Bulk delete failed")}finally{v(!1)}}},disabled:0===s.length,children:"Bulk Delete"}),(0,i.jsx)("button",{className:"px-3 py-1 bg-green-600 text-white rounded disabled:opacity-50",onClick:()=>{0!==s.length&&window.confirm("Are you sure you want to start ".concat(s.length," selected test(s)?"))&&(b([...s]),p({open:!0,testId:s[0],idx:0,start:"",end:"",duration:""}))},disabled:0===s.length,children:"Bulk Start"}),(0,i.jsxs)("span",{className:"text-xs text-gray-500",children:[s.length," selected"]})]}),(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"min-w-full border text-sm","aria-label":"All tests table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"bg-gray-100",children:[(0,i.jsx)("th",{className:"border px-2 py-1",children:(0,i.jsx)("input",{type:"checkbox",checked:x,onChange:()=>{c(x?[]:d.map(e=>e._id))},"aria-label":"Select all tests"})}),(0,i.jsx)("th",{className:"border px-2 py-1",children:"Title"}),(0,i.jsx)("th",{className:"border px-2 py-1",children:"Questions"}),(0,i.jsx)("th",{className:"border px-2 py-1",children:"Category"}),(0,i.jsx)("th",{className:"border px-2 py-1",children:"Window"}),(0,i.jsx)("th",{className:"border px-2 py-1",children:"Active"}),(0,i.jsx)("th",{className:"border px-2 py-1",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:0===d.length?(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:7,className:"text-center text-gray-500 py-8",children:"No tests found. Please create a test in the Create Test tab."})}):d.map(e=>{const t=Array.isArray(e.questions)?e.questions.length:e.totalQuestions||0;return(0,i.jsxs)("tr",{tabIndex:0,"aria-label":e.title,children:[(0,i.jsx)("td",{className:"border px-2 py-1 text-center",children:(0,i.jsx)("input",{type:"checkbox",checked:s.includes(e._id),onChange:()=>{return t=e._id,void c(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},"aria-label":"Select test ".concat(e.title)})}),(0,i.jsx)("td",{className:"border px-2 py-1",children:(0,i.jsx)("div",{className:"font-semibold",children:e.title})}),(0,i.jsx)("td",{className:"border px-2 py-1 text-center",children:t}),(0,i.jsx)("td",{className:"border px-2 py-1",children:e.category}),(0,i.jsx)("td",{className:"border px-2 py-1",children:e.startDate&&e.endDate?(0,i.jsxs)("span",{children:[new Date(e.startDate).toLocaleString()," to ",new Date(e.endDate).toLocaleString(),(0,i.jsx)("br",{}),(0,i.jsxs)("span",{className:"text-xs text-gray-500",children:["Duration: ",e.duration?e.duration+" min":Math.round((new Date(e.endDate)-new Date(e.startDate))/6e4)+" min"]})]}):(0,i.jsx)("span",{className:"text-gray-400",children:"Not set"})}),(0,i.jsx)("td",{className:"border px-2 py-1",children:e.isActive?"Yes":"No"}),(0,i.jsx)("td",{className:"border px-2 py-1",children:(0,i.jsxs)("div",{className:"flex flex-wrap gap-1 items-center",children:[(0,i.jsx)("button",{className:"px-2 py-1 bg-yellow-500 text-white rounded text-xs",onClick:()=>{return t=e._id,S(t),void C(!0);var t},"aria-label":"Add questions to ".concat(e.title),children:"Add"}),(0,i.jsx)("button",{className:"px-2 py-1 bg-gray-500 text-white rounded text-xs",onClick:()=>g(e),"aria-label":"View questions for ".concat(e.title),children:"View"}),(0,i.jsx)("button",{className:"px-2 py-1 bg-blue-600 text-white rounded text-xs",onClick:()=>(e=>{var t,s,a;O({open:!0,test:e,form:{requireAllQuestions:null===(t=e.requireAllQuestions)||void 0===t||t,allowNavigation:null===(s=e.allowNavigation)||void 0===s||s,deviceRestriction:e.deviceRestriction||"both",allowedBranches:e.allowedBranches||[],allowedYears:e.allowedYears||[],tabSwitchLimit:null!==(a=e.tabSwitchLimit)&&void 0!==a?a:3}})})(e),"aria-label":"Edit settings for ".concat(e.title),children:"Edit"}),e.isActive?(0,i.jsx)("button",{className:"px-2 py-1 bg-red-600 text-white rounded text-xs",onClick:()=>{window.confirm('Are you sure you want to stop the test "'.concat(e.title,'"?'))&&(async e=>{v(!0),y(""),w("");try{await l.A.put("/tests/".concat(e,"/deactivate")),w("Test deactivated!"),I()}catch(t){y("Failed to deactivate test")}finally{v(!1)}})(e._id)},"aria-label":"Stop test ".concat(e.title),children:"Stop"}):(0,i.jsx)("button",{className:"px-2 py-1 rounded text-xs ".concat(0===t?"bg-gray-400 text-white cursor-not-allowed":"bg-green-600 text-white"),onClick:()=>{var s;0!==t&&(window.confirm('Are you sure you want to start the test "'.concat(e.title,'"?'))&&(s=e._id,B({open:!0,testId:s,start:"",end:"",duration:""})))},"aria-label":"Start test ".concat(e.title),disabled:0===t,children:"Start"}),(0,i.jsx)("button",{className:"px-2 py-1 bg-gray-800 text-white rounded text-xs",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this test? This action cannot be undone.")){v(!0),y(""),w("");try{await l.A.delete("/tests/".concat(e)),w("Test deleted successfully!"),I()}catch(t){y("Failed to delete test")}finally{v(!1)}}})(e._id),"aria-label":"Delete test ".concat(e.title),children:"Delete"})]})})]},e._id)})})]})}),m.open&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-md",children:[(0,i.jsxs)("h3",{className:"font-semibold mb-2",children:["Set Exam Window & Duration for Test ",m.idx+1," of ",h.length]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block mb-1",children:"Start Date & Time"}),(0,i.jsx)("input",{type:"datetime-local",className:"input w-full",value:m.start,onChange:e=>p(t=>(0,a.A)((0,a.A)({},t),{},{start:e.target.value}))})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block mb-1",children:"End Date & Time"}),(0,i.jsx)("input",{type:"datetime-local",className:"input w-full",value:m.end,onChange:e=>p(t=>(0,a.A)((0,a.A)({},t),{},{end:e.target.value}))})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block mb-1",children:"Duration (minutes)"}),(0,i.jsx)("input",{type:"number",min:"1",className:"input w-full",value:m.duration,onChange:e=>p(t=>(0,a.A)((0,a.A)({},t),{},{duration:e.target.value})),placeholder:"Enter duration in minutes"})]}),(0,i.jsxs)("div",{className:"flex space-x-2",children:[(0,i.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:async()=>{const{testId:e,start:t,end:s,duration:a,idx:n}=m;v(!0),y("");try{const i=parseInt(a,10);if(!t||!s||isNaN(i)||i<1)return y("Please fill all fields for this test."),void v(!1);await l.A.put("/tests/".concat(e,"/activate"),{startDate:t,endDate:s,duration:i}),n+1<h.length?p({open:!0,testId:h[n+1],idx:n+1,start:"",end:"",duration:""}):(p({open:!1,testId:null,idx:0,start:"",end:"",duration:""}),b([]),w("Selected tests started!"),c([]),I())}catch(i){y("Failed to start test")}finally{v(!1)}},disabled:!m.start||!m.end||!m.duration||j,children:m.idx+1===h.length?"Start Last Test":"Start & Next"}),(0,i.jsx)("button",{className:"px-4 py-2 bg-gray-400 text-white rounded",onClick:()=>{p({open:!1,testId:null,idx:0,start:"",end:"",duration:""}),b([])},children:"Cancel"})]})]})}),L.open&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-md",children:[(0,i.jsx)("h3",{className:"font-semibold mb-4",children:"Edit Test Settings"}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"block font-medium mb-1",children:"Require All Questions to be Attempted"}),(0,i.jsx)("input",{type:"checkbox",checked:L.form.requireAllQuestions,onChange:e=>F("requireAllQuestions",e.target.checked)}),(0,i.jsx)("span",{className:"ml-2",children:"ON"})]}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"block font-medium mb-1",children:"Allow Navigation Between Questions"}),(0,i.jsx)("input",{type:"checkbox",checked:L.form.allowNavigation,onChange:e=>F("allowNavigation",e.target.checked)}),(0,i.jsx)("span",{className:"ml-2",children:"ON"})]}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"block font-medium mb-1",children:"Tab Switch Limit"}),(0,i.jsx)("input",{type:"number",min:1,max:10,value:L.form.tabSwitchLimit,onChange:e=>F("tabSwitchLimit",Number(e.target.value)),className:"input w-20 ml-2"}),(0,i.jsx)("span",{className:"ml-2 text-xs",children:"(Default: 3, 4th switch auto-submits)"})]}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"block font-medium mb-1",children:"Device Restriction"}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"radio",name:"deviceRestriction",value:"mobile",checked:"mobile"===L.form.deviceRestriction,onChange:e=>F("deviceRestriction",e.target.value)})," Mobile Only"]}),(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"radio",name:"deviceRestriction",value:"desktop",checked:"desktop"===L.form.deviceRestriction,onChange:e=>F("deviceRestriction",e.target.value)})," Laptop/Desktop Only"]}),(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"radio",name:"deviceRestriction",value:"both",checked:"both"===L.form.deviceRestriction,onChange:e=>F("deviceRestriction",e.target.value)})," Both"]})]})]}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"block font-medium mb-1",children:"Allowed Branches"}),(0,i.jsxs)("select",{multiple:!0,className:"input w-full",value:L.form.allowedBranches,onChange:e=>{const t=Array.from(e.target.selectedOptions,e=>e.value);t.includes("__ALL__")?F("allowedBranches",["__ALL__"]):F("allowedBranches",t)},children:[(0,i.jsx)("option",{value:"__ALL__",children:"All Branches (Allow all students)"}),q.map(e=>(0,i.jsx)("option",{value:e,children:e},e))]})]}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"block font-medium mb-1",children:"Allowed Years"}),(0,i.jsxs)("select",{multiple:!0,className:"input w-full",value:L.form.allowedYears,onChange:e=>{const t=Array.from(e.target.selectedOptions,e=>e.value);t.includes("__ALL__")?F("allowedYears",["__ALL__"]):F("allowedYears",t)},children:[(0,i.jsx)("option",{value:"__ALL__",children:"All Years (Allow all students)"}),D.map(e=>(0,i.jsx)("option",{value:e,children:e},e))]})]}),(0,i.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,i.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:async()=>{if(v(!0),y(""),w(""),!L.form.tabSwitchLimit||L.form.tabSwitchLimit<1)return y("Tab Switch Limit must be at least 1"),void v(!1);if(!L.form.allowedBranches||0===L.form.allowedBranches.length)return y("Select at least one allowed branch"),void v(!1);if(!L.form.allowedYears||0===L.form.allowedYears.length)return y("Select at least one allowed year"),void v(!1);try{await l.A.put("/tests/".concat(L.test._id),L.form),w("Test settings updated!"),R(),I()}catch(s){var e,t;y((null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to update test settings")}finally{v(!1)}},disabled:j,children:"Save"}),(0,i.jsx)("button",{className:"px-4 py-2 bg-gray-400 text-white rounded",onClick:R,children:"Cancel"})]})]})}),A&&(0,i.jsx)(r,{closeQModal:()=>{C(!1),S(null)},handleAddQuestions:async e=>{if(k&&e&&0!==e.length){v(!0),y(""),w("");try{await l.A.put("/tests/".concat(k,"/questions"),{questions:e}),w("Questions added!"),I()}catch(t){y("Failed to add questions")}finally{v(!1)}}},loading:j}),e.open&&(0,i.jsx)(o,{questions:e.questions,testId:e.testId,testTitle:e.testTitle,onClose:()=>t({open:!1,questions:[],testTitle:""}),fetchQuestions:g}),Q.open&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-md",children:[(0,i.jsx)("h3",{className:"font-semibold mb-2",children:"Set Exam Window & Duration"}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block mb-1",children:"Start Date & Time"}),(0,i.jsx)("input",{type:"datetime-local",className:"input w-full",value:Q.start,onChange:e=>B(t=>(0,a.A)((0,a.A)({},t),{},{start:e.target.value}))})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block mb-1",children:"End Date & Time"}),(0,i.jsx)("input",{type:"datetime-local",className:"input w-full",value:Q.end,onChange:e=>B(t=>(0,a.A)((0,a.A)({},t),{},{end:e.target.value}))})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block mb-1",children:"Duration (minutes)"}),(0,i.jsx)("input",{type:"number",min:"1",className:"input w-full",value:Q.duration,onChange:e=>B(t=>(0,a.A)((0,a.A)({},t),{},{duration:e.target.value})),placeholder:"Enter duration in minutes"})]}),(0,i.jsxs)("div",{className:"flex space-x-2",children:[(0,i.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:()=>(async(e,t,s,a)=>{v(!0),y(""),w("");try{const n=parseInt(a,10);if(!t||!s)return y("Please select both start and end date/time"),void v(!1);if(isNaN(n)||n<1)return y("Please enter a valid duration (minutes)"),void v(!1);await l.A.put("/tests/".concat(e,"/activate"),{startDate:t,endDate:s,duration:n}),w("Test activated!"),B({open:!1,testId:null,start:"",end:"",duration:""}),I()}catch(o){var n,i;const e=null===(n=o.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message;y(e||"Failed to activate test")}finally{v(!1)}})(Q.testId,Q.start,Q.end,Q.duration),disabled:!Q.start||!Q.end||!Q.duration||j,children:"Start Test"}),(0,i.jsx)("button",{className:"px-4 py-2 bg-gray-400 text-white rounded",onClick:()=>B({open:!1,testId:null,start:"",end:"",duration:""}),children:"Cancel"})]})]})})]})}}}]);
//# sourceMappingURL=387.e2f2dba9.chunk.js.map